<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/xml; charset=UTF-8" />
    <link rel="stylesheet" href="bower_components/theme-default/dist/styles/base.css">
    <link rel="stylesheet" href="dist/styles/base.css" type="text/css" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <title>Widget Standalone</title>
    <script>
        //portal client shimming
        window.launchpad = {
            config: {
                usemin: false
            }
        };

        window.requireWidget = function(__WIDGET__){
            delete window.requireWidget;
            document.querySelector('.engine-header h2').innerHTML = 'Widget ' + __WIDGET__.name + ' standalone';

            require(['base'], function (base) {
                base.requireWidget(__WIDGET__, 'scripts/main');
            });
        };

        /**
         * This function creates a widget engine instance, adds some plugins and, then, starts the widget engine
         */
        function renderWidget() {
            //setup a widget engine
            var widgetEngine = new portalKit.WidgetEngine({
                logLevel: 'trace'
            });

            widgetEngine.init({
                widgetUrl: '/',
                widgetEl: document.getElementById('widget-root'),
                configFile: 'model.xml',
                configVars: {
                    contextRoot: '/'
                },
                parser: new portalKit.AutoConfigParser(),
                reader: new portalKit.XhrWidgetReader({
                    noCache: true
                })
            });

            widgetEngine.addPlugin(new portalKit.ReplaceConfigVarsPlugin({
                servicesPath: '',
                itemRoot: 'itemRoot'
            }, { full: true }));

            //By default add the backbase format plugin
            widgetEngine.addPlugin(new portalKit.BackbaseFormatPlugin({
                storage: widgetEngine.widgetEngine.config.storage,
                makeIncludedRefsAbsolute: true,
                portalConf: {
                    contextItemName: 'browser-demo-app'
                }
            }));

            //start it up
            widgetEngine.start().then(function(details) {
                console.log(details.message);
                document.getElementById('details').innerHTML = '<p>' + details.message + '</p>';
            }).catch(function(err) {
                console.error(err);
                document.getElementById('details').innerHTML = '<p>' + err.stack.split('\n').join('<br>') + '</p>';
            });
        }

        document.addEventListener('DOMContentLoaded', renderWidget);
    </script>
    <script src="support/backbase-widget-engine/dist/portal-kit.js"></script>
    <script src="bower_components/requirejs/require.js"></script>
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/config/requirejs.conf.js"></script>
</head>
<body class="container">
    <header class="engine-header"><h2></h2></header>
    <main class="engine-main">
        <div id="widget-root"></div>
    </main>
    <footer class="engine-footer">
        <div id="details"></div>
    </footer>
</body>
</html>